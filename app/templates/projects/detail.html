{% extends "base.html" %}

{% block title %}{{ project.client_name }}: {{ project.project_name }} - Legal Worklist{% endblock %}

{% block content %}
<div class="project-detail">
    <div class="page-header">
        <h1>{{ project.client_name }}: {{ project.project_name }}</h1>
        <div class="actions">
            <a href="{{ url_for('projects.edit', id=project.id) }}" class="btn">Edit</a>
            <form action="{{ url_for('projects.archive', id=project.id) }}" method="post" style="display: inline;">
                <button type="submit" class="btn btn-danger">Archive</button>
            </form>
        </div>
    </div>

    <section class="project-info">
        <h2>Project Information</h2>
        <dl class="info-grid">
            <dt>Matter Number</dt>
            <dd>{{ project.matter_number or '-' }}</dd>

            <dt>Hard Deadline</dt>
            <dd>{{ project.hard_deadline or '-' }}</dd>

            <dt>Internal Deadline</dt>
            <dd>{{ project.internal_deadline }}</dd>

            <dt>Assigner</dt>
            <dd>{{ project.assigner }}</dd>

            <dt>Assigned Attorneys</dt>
            <dd>{{ project.assigned_attorneys }}</dd>

            <dt>Priority</dt>
            <dd><span class="priority priority-{{ project.priority }}">{{ project.priority }}</span></dd>

            <dt>Estimated Hours</dt>
            <dd>{{ project.estimated_hours or '-' }}</dd>
        </dl>
    </section>

    <section class="status-updates">
        <div class="section-header">
            <h2>Status Updates</h2>
            <a href="{{ url_for('updates.new') }}?project_id={{ project.id }}" class="btn btn-small">Add Update</a>
        </div>
        {% set updates = project.get_status_updates_ordered() %}
        {% if updates %}
        <ul class="update-list">
            {% for update in updates %}
            <li class="update-item">
                <span class="update-date">{{ update.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                <p class="update-notes">{{ update.notes }}</p>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="empty-state">No status updates yet.</p>
        {% endif %}
    </section>

    <section class="followups">
        <div class="section-header">
            <h2>Follow-ups</h2>
            <a href="{{ url_for('followups.new') }}?project_id={{ project.id }}" class="btn btn-small">Add Follow-up</a>
        </div>

        <h3>Pending</h3>
        {% set pending = project.get_pending_followups() %}
        {% if pending %}
        <ul class="followup-list">
            {% for followup in pending %}
            <li class="followup-item">
                <div class="followup-info">
                    <span class="followup-target">{{ followup.target_name }}</span>
                    <span class="followup-type">({{ followup.target_type }})</span>
                    <span class="followup-due">Due: {{ followup.due_date }}</span>
                    {% if followup.notes %}
                    <p class="followup-notes">{{ followup.notes }}</p>
                    {% endif %}
                </div>
                <div class="followup-actions">
                    <form action="{{ url_for('followups.complete', id=followup.id) }}" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-small btn-success">Complete</button>
                    </form>
                    <form action="{{ url_for('followups.snooze', id=followup.id) }}" method="post" style="display: inline;">
                        <input type="number" name="days" value="1" min="1" max="365" style="width: 50px;">
                        <button type="submit" class="btn btn-small">Snooze</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="empty-state">No pending follow-ups.</p>
        {% endif %}

        <h3>Completed</h3>
        {% set completed = project.get_completed_followups() %}
        {% if completed %}
        <ul class="followup-list">
            {% for followup in completed %}
            <li class="followup-item followup-completed">
                <div class="followup-info">
                    <span class="followup-target">{{ followup.target_name }}</span>
                    <span class="followup-type">({{ followup.target_type }})</span>
                    <span class="followup-completed-at">Completed: {{ followup.completed_at.strftime('%Y-%m-%d %H:%M') }}</span>
                    {% if followup.notes %}
                    <p class="followup-notes">{{ followup.notes }}</p>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="empty-state">No completed follow-ups.</p>
        {% endif %}
    </section>
</div>
{% endblock %}
